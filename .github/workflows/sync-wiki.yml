name: Sync Wiki Content

on:
  push:
    branches:
      - main
    paths:
      - 'wiki/**'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  sync-wiki:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check if wiki is enabled
        id: wiki-check
        run: |
          # Try to access the wiki repository to check if it exists
          WIKI_URL="https://github.com/${{ github.repository }}.wiki.git"
          if git ls-remote --exit-code "$WIKI_URL" > /dev/null 2>&1; then
            echo "wiki_enabled=true" >> $GITHUB_OUTPUT
            echo "✅ Wiki repository exists at $WIKI_URL"
          else
            echo "wiki_enabled=false" >> $GITHUB_OUTPUT
            echo "⚠️ Wiki repository not found at $WIKI_URL"
            echo ""
            echo "To enable the wiki:"
            echo "1. Go to repository Settings > General"
            echo "2. Scroll down to the Features section"
            echo "3. Check the 'Wikis' checkbox"
            echo "4. Create at least one wiki page manually to initialize the wiki repository"
            echo "5. Re-run this workflow"
          fi

      - name: Sync wiki content
        if: steps.wiki-check.outputs.wiki_enabled == 'true'
        uses: Andrew-Chen-Wang/github-wiki-action@v4
        with:
          path: wiki
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Wiki sync skipped
        if: steps.wiki-check.outputs.wiki_enabled == 'false'
        run: |
          echo "::warning::Wiki sync skipped because the wiki is not enabled for this repository. Please enable the wiki in repository settings and create at least one wiki page to initialize it."
